<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🌙 心理測驗小屋</title>
<style>
body {
  font-family: "Noto Sans TC", sans-serif;
  background: linear-gradient(180deg, #f8f5ff, #e5e0ff);
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
  margin: 0;
  padding-top: 40px;
  overflow-x: hidden;
}

.container {
  background: #ffffffdd;
  backdrop-filter: blur(8px);
  padding: 40px;
  border-radius: 20px;
  width: 420px;
  text-align: center;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  position: relative;
}

h1 {
  color: #6650a4;
  font-size: 24px;
  margin-bottom: 20px;
}

.question {
  font-size: 18px;
  color: #444;
  margin-bottom: 20px;
  min-height: 60px;
  transition: opacity 0.5s ease;
}

.options button {
  background: #b4a8ff;
  color: #fff;
  border: none;
  padding: 10px 16px;
  margin: 6px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 16px;
  transition: background 0.3s ease;
}
.options button:hover { background: #8e7bff; }

.result {
  display: none;
  font-size: 18px;
  color: #333;
  margin-top: 20px;
}

.restart-btn {
  background: #ffd2e8;
  color: #333;
  border: none;
  padding: 8px 16px;
  border-radius: 10px;
  cursor: pointer;
  margin-top: 20px;
}

/* 🌸 Q版小人 */
.mascot {
  position: absolute;
  right: -150px;
  bottom: 0;
  width: 120px;
  height: 160px;
  background: url('https://cdn-icons-png.flaticon.com/512/4712/4712104.png') no-repeat center/contain;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

/* 🌼 對話框 */
.speech-bubble {
  position: absolute;
  right: -220px;
  bottom: 120px;
  background: #fff;
  color: #333;
  border-radius: 12px;
  padding: 10px 14px;
  width: 160px;
  text-align: left;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  opacity: 0;
  transform: scale(0.8);
  transition: all 0.4s ease;
}
.speech-bubble.active { opacity: 1; transform: scale(1); }
.speech-bubble::after {
  content: "";
  position: absolute;
  right: -10px;
  bottom: 10px;
  border-width: 8px;
  border-style: solid;
  border-color: transparent transparent transparent #fff;
}

/* 📝 歷史紀錄 */
.history {
  margin-top: 30px;
  text-align: left;
  font-size: 14px;
}
.history-header {
  font-weight: bold;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.history-header button {
  background: #ffaec5;
  border: none;
  border-radius: 6px;
  padding: 2px 6px;
  cursor: pointer;
  font-size: 12px;
  color: #333;
}
.history-item { margin-top: 6px; }
</style>
</head>
<body>

<div class="container">
  <h1>🌙 心理測驗小屋</h1>
  <div id="question" class="question"></div>
  <div id="options" class="options"></div>
  <div id="result" class="result"></div>
  <button id="restart" class="restart-btn" style="display:none;">重新測驗</button>

  <div class="mascot"></div>
  <div id="bubble" class="speech-bubble">嗨～準備好了嗎？</div>

  <div class="history">
    <div class="history-header">
      歷史紀錄
      <button id="clearHistory">清除紀錄</button>
    </div>
    <div id="historyList"></div>
  </div>
</div>

<script>
const questions = [
  { text: "你走在森林裡，前方出現一條分岔路，你會？", options: [ { text: "選擇左邊明亮的那條路", score: 4, next: 1 }, { text: "走進右邊幽暗的小徑", score: 2, next: 2 } ] },
  { text: "你在光亮的路上發現一隻小貓牠受傷了，你會？", options: [ { text: "帶回家照顧牠", score: 4, next: "A" }, { text: "幫牠包紮後離開", score: 3, next: "B" } ] },
  { text: "在幽暗的小徑中你聽到奇怪的聲音，你會？", options: [ { text: "往聲音的方向走去", score: 4, next: "C" }, { text: "轉身離開那裡", score: 2, next: "D" } ] }
];

const results = {
  A: "🌸 你是溫柔而細膩的人，總是願意為別人付出。",
  B: "🌿 你心地善良但懂得界線，不會讓自己過度消耗。",
  C: "🔥 你擁有冒險精神，喜歡挑戰未知的世界。",
  D: "🌙 你敏銳而謹慎，知道什麼該保護、什麼該放下。"
};

const bubbles = {
  start: "嗨～準備好了嗎？",
  question: [ "這題有點難對吧～慢慢想也可以喔。", "這樣的選擇，好像能看出妳的個性呢～", "別緊張，我都在這裡陪妳。" ],
  result: [ "測完了～想知道結果嗎？✨", "這樣的妳，我覺得很好呀🌷" ]
};

let currentQuestion = 0;
let totalScore = 0;

const questionEl = document.getElementById("question");
const optionsEl = document.getElementById("options");
const resultEl = document.getElementById("result");
const restartBtn = document.getElementById("restart");
const bubbleEl = document.getElementById("bubble");
const historyList = document.getElementById("historyList");
const clearHistoryBtn = document.getElementById("clearHistory");

function showBubble(text) {
  bubbleEl.classList.remove("active");
  setTimeout(() => {
    bubbleEl.innerText = text;
    bubbleEl.classList.add("active");
  }, 200);
}

function showQuestion(index) {
  const q = questions[index];
  questionEl.innerText = `(${index+1}/${questions.length}) ${q.text}`;
  optionsEl.innerHTML = "";
  q.options.forEach(option => {
    const btn = document.createElement("button");
    btn.textContent = option.text;
    btn.onclick = () => handleAnswer(option);
    optionsEl.appendChild(btn);
  });
  showBubble(bubbles.question[Math.floor(Math.random() * bubbles.question.length)]);
}

function handleAnswer(option) {
  totalScore += option.score;
  if (typeof option.next === "number") {
    currentQuestion = option.next;
    showQuestion(currentQuestion);
  } else {
    showResult(option.next);
  }
}

function showResult(key) {
  questionEl.style.display = "none";
  optionsEl.style.display = "none";
  resultEl.style.display = "block";
  restartBtn.style.display = "inline-block";
  const text = results[key] + ` (分數: ${totalScore})`;
  resultEl.innerText = text;

  // 儲存歷史紀錄
  const history = JSON.parse(localStorage.getItem("quizHistory") || "[]");
  history.push({ date: new Date().toLocaleString(), score: totalScore, result: results[key] });
  localStorage.setItem("quizHistory", JSON.stringify(history));
  updateHistory();

  showBubble(bubbles.result[Math.floor(Math.random() * bubbles.result.length)]);
}

function updateHistory() {
  const history = JSON.parse(localStorage.getItem("quizHistory") || "[]");
  historyList.innerHTML = "";
  history.forEach(item => {
    const div = document.createElement("div");
    div.className = "history-item";
    div.innerText = `${item.date} | 分數: ${item.score} | 結果: ${item.result}`;
    historyList.appendChild(div);
  });
}

restartBtn.addEventListener("click", () => {
  currentQuestion = 0;
  totalScore = 0;
  questionEl.style.display = "block";
  optionsEl.style.display = "block";
  resultEl.style.display = "none";
  restartBtn.style.display = "none";
  showQuestion(currentQuestion);
});

clearHistoryBtn.addEventListener("click", () => {
  localStorage.removeItem("quizHistory");
  updateHistory();
});

// 初始化
updateHistory();
showQuestion(currentQuestion);
</script>

</body>
</html>
