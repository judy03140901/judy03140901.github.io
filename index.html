<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸŒ™ å¿ƒç†æ¸¬é©—å°å±‹</title>
<style>
body {
  font-family: "Noto Sans TC", sans-serif;
  background: linear-gradient(180deg, #f8f5ff, #e5e0ff);
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
  margin: 0;
  padding-top: 40px;
  overflow-x: hidden;
}
.container {
  background: #ffffffdd;
  backdrop-filter: blur(8px);
  padding: 40px;
  border-radius: 20px;
  width: 420px;
  text-align: center;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  position: relative;
}
h1 { color: #6650a4; font-size: 24px; margin-bottom: 20px; }
.question { font-size: 18px; color: #444; margin-bottom: 20px; min-height: 60px; transition: opacity 0.5s ease; }
.options button {
  background: #b4a8ff; color: #fff; border: none; padding: 10px 16px;
  margin: 6px; border-radius: 10px; cursor: pointer; font-size: 16px; transition: background 0.3s ease;
}
.options button:hover { background: #8e7bff; }
.result { display: none; font-size: 18px; color: #333; margin-top: 20px; }
.restart-btn { background: #ffd2e8; color: #333; border: none; padding: 8px 16px; border-radius: 10px; cursor: pointer; margin-top: 20px; }
.mascot { position: absolute; right: -150px; bottom: 0; width: 120px; height: 160px; background: url('https://cdn-icons-png.flaticon.com/512/4712/4712104.png') no-repeat center/contain; animation: float 3s ease-in-out infinite; }
@keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
.speech-bubble {
  position: absolute; right: -220px; bottom: 120px; background: #fff; color: #333; border-radius: 12px;
  padding: 10px 14px; width: 160px; text-align: left; box-shadow: 0 4px 8px rgba(0,0,0,0.1); opacity: 0; transform: scale(0.8); transition: all 0.4s ease;
}
.speech-bubble.active { opacity: 1; transform: scale(1); }
.speech-bubble::after { content: ""; position: absolute; right: -10px; bottom: 10px; border-width: 8px; border-style: solid; border-color: transparent transparent transparent #fff; }
.history { margin-top: 30px; text-align: left; font-size: 14px; }
.history-header { font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
.history-header button { background: #ffaec5; border: none; border-radius: 6px; padding: 2px 6px; cursor: pointer; font-size: 12px; color: #333; }
.history-item { margin-top: 6px; }
</style>
</head>
<body>
<div class="container">
  <h1>ğŸŒ™ å¿ƒç†æ¸¬é©—å°å±‹</h1>
  <div id="question" class="question"></div>
  <div id="options" class="options"></div>
  <div id="result" class="result"></div>
  <button id="restart" class="restart-btn" style="display:none;">é‡æ–°æ¸¬é©—</button>
  <div class="mascot"></div>
  <div id="bubble" class="speech-bubble">å—¨ï½æº–å‚™å¥½äº†å—ï¼Ÿ</div>
  <div class="history">
    <div class="history-header">
      æ­·å²ç´€éŒ„
      <button id="clearHistory">æ¸…é™¤ç´€éŒ„</button>
    </div>
    <div id="historyList"></div>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

// Firebase é…ç½®ï¼ˆæ”¹æˆä½ çš„ï¼‰
 const firebaseConfig = {
    apiKey: "AIzaSyCf0dJj901z6JyFp1dEfBufrBtiztyjQqo",
    authDomain: "psych-test-house.firebaseapp.com",
    projectId: "psych-test-house",
    storageBucket: "psych-test-house.firebasestorage.app",
    messagingSenderId: "1084908373457",
    appId: "1:1084908373457:web:923e6ec4124f48b9a74cf0"
  };

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const historyCollection = collection(db,"quizHistory");

const questions = [
  { text: "ä½ èµ°åœ¨æ£®æ—è£¡ï¼Œå‰æ–¹å‡ºç¾ä¸€æ¢åˆ†å²”è·¯ï¼Œä½ æœƒï¼Ÿ", options: [{text:"å·¦é‚Šæ˜äº®çš„è·¯", score:4,next:1},{text:"å³é‚Šå¹½æš—å°å¾‘", score:2,next:2}]},
  { text: "å…‰äº®çš„è·¯ä¸Šä½ ç™¼ç¾ä¸€éš»å°è²“ï¼Œä½ æœƒï¼Ÿ", options:[{text:"å¸¶å›å®¶ç…§é¡§", score:4,next:3},{text:"å¹«ç‰ åŒ…ç´®å¾Œé›¢é–‹", score:3,next:4}]},
  { text: "å¹½æš—å°å¾‘è½åˆ°å¥‡æ€ªè²éŸ³ï¼Œä½ æœƒï¼Ÿ", options:[{text:"èµ°å‘è²éŸ³", score:4,next:5},{text:"è½‰èº«é›¢é–‹", score:2,next:6}]},
  { text: "ä½ é‡åˆ°ä¸€å€‹è¿·è·¯çš„å°å­©ï¼Œä½ æœƒï¼Ÿ", options:[{text:"å¸¶ä»–å›å®¶", score:4,next:7},{text:"å¹«å¿™æŒ‡è·¯", score:3,next:8}]},
  { text: "çœ‹åˆ°ç¾éº—çš„æ¹–æ³Šï¼Œä½ æœƒï¼Ÿ", options:[{text:"ä¸‹æ°´æ¸¸æ³³", score:4,next:9},{text:"åœ¨æ¹–é‚Šæ‹ç…§", score:3,next:10}]},
  { text: "å¤œæ™šçœ‹åˆ°æµæ˜Ÿï¼Œä½ æœƒï¼Ÿ", options:[{text:"è¨±é¡˜", score:4,next:11},{text:"éœéœæ¬£è³", score:3,next:12}]},
  { text: "æœ‹å‹é‚€ä½ å†’éšªï¼Œä½ æœƒï¼Ÿ", options:[{text:"é¦¬ä¸Šç­”æ‡‰", score:4,next:13},{text:"å…ˆè€ƒæ…®", score:3,next:14}]},
  { text: "ä¸‹é›¨æ™‚ä½ æœƒï¼Ÿ", options:[{text:"æ’å‚˜æ•£æ­¥", score:3,next:"A"},{text:"åœ¨å®¶çœ‹æ›¸", score:4,next:"A"}]},
  { text: "çœ‹åˆ°æœ‰äººéœ€è¦å¹«åŠ©ï¼Œä½ æœƒï¼Ÿ", options:[{text:"ä¸»å‹•å¹«åŠ©", score:4,next:"B"},{text:"è§€å¯Ÿå†è¡Œå‹•", score:3,next:"B"}]},
  { text: "é‡åˆ°å›°é›£ä½ æœƒï¼Ÿ", options:[{text:"è¿é›£è€Œä¸Š", score:4,next:"C"},{text:"æ‰¾æ–¹æ³•é¿é–‹", score:3,next:"C"}]},
  { text: "å‡æ—¥ä½ å–œæ­¡ï¼Ÿ", options:[{text:"æˆ¶å¤–æ´»å‹•", score:4,next:"D"},{text:"å®…åœ¨å®¶", score:3,next:"D"}]},
  { text: "æ”¶åˆ°ç¦®ç‰©ä½ æœƒï¼Ÿ", options:[{text:"å¾ˆé–‹å¿ƒè¡¨é”æ„Ÿè¬", score:4,next:"A"},{text:"é»˜é»˜çæƒœ", score:3,next:"A"}]},
  { text: "é¢å°æŒ‘æˆ°ä½ æœƒï¼Ÿ", options:[{text:"å‹‡æ•¢é¢å°", score:4,next:"B"},{text:"å…ˆè§€å¯Ÿæƒ…æ³", score:3,next:"B"}]},
  { text: "æ™šé–“ä½ å–œæ­¡åšä»€éº¼ï¼Ÿ", options:[{text:"æ•£æ­¥æ€è€ƒ", score:3,next:"C"},{text:"ç©éŠæˆ²æ”¾é¬†", score:4,next:"C"}]},
  { text: "æœ‹å‹é‚€è«‹ä½ èšæœƒï¼Œä½ æœƒï¼Ÿ", options:[{text:"ç†±æƒ…åƒåŠ ", score:4,next:"D"},{text:"å©‰æ‹’ä¼‘æ¯", score:3,next:"D"}]}
];

const results = {
  A:"ğŸŒ¸ ä½ æ˜¯æº«æŸ”ç´°è†©ï¼Œç¸½ç‚ºä»–äººä»˜å‡ºã€‚",
  B:"ğŸŒ¿ ä½ æ‡‚å¾—ç•Œç·šï¼Œä¸æœƒéåº¦æ¶ˆè€—è‡ªå·±ã€‚",
  C:"ğŸ”¥ ä½ å–œæ­¡å†’éšªï¼Œæ¨‚æ–¼æŒ‘æˆ°æœªçŸ¥ã€‚",
  D:"ğŸŒ™ ä½ è¬¹æ…æ•éŠ³ï¼ŒçŸ¥é“ä¿è­·èˆ‡æ”¾ä¸‹ã€‚"
};

const bubbles = {
  start:"å—¨ï½æº–å‚™å¥½äº†å—ï¼Ÿ",
  question:["æ…¢æ…¢æƒ³ä¹Ÿå¯ä»¥å–”ï½","é€™æ¨£çš„é¸æ“‡çœ‹å¾—å‡ºå¦³çš„å€‹æ€§","åˆ¥ç·Šå¼µï¼Œæˆ‘éƒ½åœ¨é€™é™ªå¦³"],
  result:["æ¸¬å®Œäº†ï½æƒ³çŸ¥é“çµæœå—ï¼Ÿâœ¨","é€™æ¨£çš„å¦³ï¼Œæˆ‘è¦ºå¾—å¾ˆå¥½å‘€ğŸŒ·"]
};

let currentQuestion=0;
let totalScore=0;

const questionEl=document.getElementById("question");
const optionsEl=document.getElementById("options");
const resultEl=document.getElementById("result");
const restartBtn=document.getElementById("restart");
const bubbleEl=document.getElementById("bubble");
const historyList=document.getElementById("historyList");
const clearHistoryBtn=document.getElementById("clearHistory");

function showBubble(text){
  bubbleEl.classList.remove("active");
  setTimeout(()=>{ bubbleEl.innerText=text; bubbleEl.classList.add("active"); },200);
}

function showQuestion(index){
  const q=questions[index];
  questionEl.innerText=`(${index+1}/15) ${q.text}`;
  optionsEl.innerHTML="";
  q.options.forEach(option=>{
    const btn=document.createElement("button");
    btn.textContent=option.text;
    btn.onclick=()=>handleAnswer(option);
    optionsEl.appendChild(btn);
  });
  showBubble(bubbles.question[Math.floor(Math.random()*bubbles.question.length)]);
}

function animateScore(finalScore){
  let current=0;
  const anim=setInterval(()=>{
    current++;
    resultEl.innerText=`åˆ†æ•¸: ${current}`;
    if(current>=finalScore) clearInterval(anim);
  },50);
}

async function handleAnswer(option){
  totalScore+=option.score;
  if(typeof option.next==="number") { currentQuestion=option.next; showQuestion(currentQuestion);}
  else { await showResult(option.next);}
}

async function showResult(key){
  questionEl.style.display="none";
  optionsEl.style.display="none";
  resultEl.style.display="block";
  restartBtn.style.display="inline-block";
  resultEl.innerText=results[key];
  animateScore(totalScore);

  const record = {
    username: prompt("è«‹è¼¸å…¥æ‚¨çš„åç¨±","+0")||"+0",
    score: totalScore,
    date: new Date().toLocaleString(),
    result: results[key]
  };

  // å­˜åˆ° Firebase
  await addDoc(historyCollection,record);

  // å­˜åˆ° localStorage
  const history = JSON.parse(localStorage.getItem("quizHistory")||"[]");
  history.push(record);
  localStorage.setItem("quizHistory",JSON.stringify(history));
  updateHistory();
  showBubble(bubbles.result[Math.floor(Math.random()*bubbles.result.length)]);
}

function updateHistory(){
  const history = JSON.parse(localStorage.getItem("quizHistory")||"[]");
  historyList.innerHTML="";
  history.forEach(item=>{
    const div=document.createElement("div");
    div.className="history-item";
    div.innerText=`${item.date} | åˆ†æ•¸: ${item.score} | çµæœ: ${item.result} | ä½¿ç”¨è€…: ${item.username}`;
    historyList.appendChild(div);
  });
}

restartBtn.addEventListener("click",()=>{
  currentQuestion=0;
  totalScore=0;
  questionEl.style.display="block";
  optionsEl.style.display="block";
  resultEl.style.display="none";
  restartBtn.style.display="none";
  showQuestion(currentQuestion);
});

clearHistoryBtn.addEventListener("click",()=>{
  localStorage.removeItem("quizHistory");
  updateHistory();
});

updateHistory();
showQuestion(currentQuestion);
</script>
</body>
</html>
